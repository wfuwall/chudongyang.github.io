(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{671:function(e,t,a){"use strict";a.r(t);var r=a(49),n=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h3",{attrs:{id:"node-jsæµ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-jsæµ"}},[e._v("#")]),e._v(" Node.jsæµ")]),e._v(" "),a("img",{attrs:{src:"/nodeJsæµ.jpg",height:"400",width:"auto"}}),e._v(" "),a("p",[e._v("ä¿—è¯è¯´çš„å¥½ï¼šâ€œäººå¾€é«˜å¤„èµ°ï¼Œæ°´å¾€ä½å¤„æµâ€ï¼›å¤è¯­æœ‰äº‘ï¼šâ€œè½èŠ±æœ‰æ„ï¼Œæµæ°´æ— æƒ…â€ã€‚ï¼ˆ"),a("code",[e._v("åƒç“œç¾¤ä¼—ï¼šwhatï¼Ÿä½ ç‰¹ä¹ˆè¿™æ˜¯è¦å¼„å•¥å“©ï¼äºŒè¥é•¿ğŸ“£")]),e._v("ï¼‰å“å‘€ğŸ¤£ï¼Œå„ä½å¤§ä½¬ï¼Œè¿™ç‚¹å°äº‹ç”¨ä¸ç€æƒŠåŠ¨äºŒè¥é•¿çš„æ„å¤§åˆ©ç‚®äº†å§ï¼Œè¿›é”™é¢‘é“äº†ï¼Œé©¬ä¸Šå¼€å§‹æ­£é¢˜ï¼")]),e._v(" "),a("h3",{attrs:{id:"æµåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ"}},[e._v("#")]),e._v(" æµåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ")]),e._v(" "),a("p",[a("code",[e._v("Node.jsçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆfsæ ¸å¿ƒæ¨¡å—ï¼‰")]),e._v("åœ¨æˆ‘ä»¬çš„å¼€å‘ä¸­åº”è¯¥ç»å¸¸ç”¨åˆ°ï¼Œåœ¨æ²¡æœ‰æ·±å…¥äº†è§£å­¦ä¹ ä¹‹å‰ï¼Œå¦‚æœæœ‰äººé—®æˆ‘"),a("code",[e._v("Node.jsæµ")]),e._v("åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿæˆ‘å½“æ—¶çš„è¡¨æƒ…ä¸€å®šæ˜¯è¿™æ ·æ™’çš„ï¼š")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/8/16/165423c935da2d5b?w=240&h=240&f=jpeg&s=4288",alt:""}})]),e._v(" "),a("blockquote",[a("p",[e._v("æµåˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿä¸ç»™æç¤ºè®©æˆ‘æ€ä¹ˆè¯´çš„å‡ºå˜´ï¼Ÿè¿™ç§é—®é¢˜ï¼Œå“å‘€è„‘å£³ç—›å•Šï¼çœ‹æ¥åªèƒ½å»googleäº†ï¼ˆå“¼~æˆ‘ç¨‹åºçŒ¿æ—©å·²æˆ’äº†ç™¾åº¦ï¼‰ã€‚")])]),e._v(" "),a("p",[e._v("ç¿»äº†å¥½å‡ ç¯‡å¤§ä½¬å†™çš„æ–‡ç« ï¼Œä¸èƒ½è¯´å®Œå…¨è§£æƒ‘å§ï¼Œä¹Ÿç®—æ˜¯æ”¶è·æ»¡æ»¡å“¦ğŸ™ƒï¼ä½†æ˜¯\nå‘¢ï¼Œè¿˜æ˜¯è§‰çš„å®ƒæœ‰é‚£ä¹ˆç‚¹æŠ½è±¡ï¼Œåˆæœ‰é‚£ä¹ˆç‚¹éš¾ä»¥ç†è§£ï¼ç—›å®šæ€ç—›ä¸‹ï¼Œå†³å®šæŠŠå¤§ä½¬ä»¬çš„ç†è§£åœ¨å°æœ¬æœ¬ä¸Šè®°ä¸‹æ¥æ…¢æ…¢ç†è§£ã€‚ï¼ˆéº»éº»å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘ä¸‹æ¬¡è¢«é—®åˆ°è¿˜è’™åœˆäº†ï¼‰")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("æµæ˜¯æ•°æ®çš„é›†åˆâ€”â€”å°±åƒæ•°ç»„æˆ–å­—ç¬¦ä¸²ä¸€æ ·")]),e._v("ã€‚åŒºåˆ«åœ¨äºæµä¸­çš„æ•°æ®å¯èƒ½ä¸ä¼šç«‹åˆ»å°±å…¨éƒ¨å¯ç”¨ï¼Œå¹¶ä¸”æ— éœ€ä¸€æ¬¡æ€§åœ°æŠŠè¿™äº›æ•°æ®å…¨éƒ¨æ”¾å…¥å†…å­˜ä¸­ã€‚è¿™ä½¿å¾—æµåœ¨æ“ä½œå¤§é‡æ•°æ®æˆ–è€…ä¸€æ¬¡æ¥è‡ªå¤–éƒ¨æºçš„æ•°æ®æ—¶å˜å¾—éå¸¸å¼ºå¤§ã€‚")])]),e._v(" "),a("blockquote",[a("p",[e._v("æ¥è‡ªäºï¼š"),a("a",{attrs:{href:"https://medium.freecodecamp.org/node-js-streams-everything-you-need-to-know-c9141306be93",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js Streams: Everything you need to know"),a("OutboundLink")],1)])]),e._v(" "),a("ul",[a("li",[a("code",[e._v("æµæ˜¯ä¸€ç»„æœ‰åºçš„ï¼Œæœ‰èµ·ç‚¹å’Œç»ˆç‚¹çš„å­—èŠ‚æ•°æ®ä¼ è¾“æ‰‹æ®µã€‚")]),e._v("åœ¨åº”ç”¨ç¨‹åºä¸­å„ç§å¯¹è±¡ä¹‹é—´äº¤æ¢ä¸ä¼ è¾“æ•°æ®çš„æ—¶å€™ï¼Œæ€»æ˜¯å…ˆå°†è¯¥å¯¹è±¡ä¸­æ‰€åŒ…å«çš„æ•°æ®è½¬æ¢ä¸ºå„ç§å½¢å¼çš„æµæ•°æ®ï¼ˆå³å­—èŠ‚æ•°æ®ï¼‰ï¼Œåœ¨é€šè¿‡æµçš„ä¼ è¾“ï¼Œåˆ°è¾¾ç›®çš„å¯¹è±¡åå†å°†æµæ•°æ®è½¬æ¢ä¸ºè¯¥å¯¹è±¡ä¸­å¯ä»¥ä½¿ç”¨çš„æ•°æ®ã€‚")])]),e._v(" "),a("blockquote",[a("p",[e._v("æ¥è‡ªäºï¼šã€ŠNode.jsæƒå¨æŒ‡å—ã€‹")])]),e._v(" "),a("h3",{attrs:{id:"node-jsä¸­æµçš„ç±»å‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-jsä¸­æµçš„ç±»å‹"}},[e._v("#")]),e._v(" Node.jsä¸­æµçš„ç±»å‹")]),e._v(" "),a("p",[e._v("çŸ¥é“äº†æµæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸€ä¸‹åœ¨Node.jsä¸­æµçš„ç±»å‹ã€‚æµæ˜¯ä¸€ä¸ªå¾ˆæŠ½è±¡æ¥å£ï¼Œä½†æ˜¯å´è¢«Node.jsä¸­çš„å¾ˆå¤šå¯¹è±¡æ‰€å®ç°ã€‚æ¯”å¦‚"),a("code",[e._v("HTTPæœåŠ¡å™¨requestå’Œresponseå¯¹è±¡éƒ½æ˜¯æµã€‚")]),e._v("é‚£æˆ‘ä»¬å°±å…ˆæ¥äº†è§£ä¸€ä¸‹Node.jsæœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š")]),e._v(" "),a("ul",[a("li",[e._v("Readableï¼šå¯è¯»æµã€‚å¦‚Node.jsçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆfsï¼‰ä¸­çš„"),a("code",[e._v("fs.createReadStream(path,options)")]),e._v("å°±æ˜¯ä¸€ä¸ªå¯è¯»æµçš„ä¾‹å­ï¼›")]),e._v(" "),a("li",[e._v("Writableï¼šå¯å†™æµã€‚å¦‚Node.jsçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆfsï¼‰ä¸­çš„"),a("code",[e._v("fs.createWriteStream(path,options)")]),e._v("å°±æ˜¯ä¸€ä¸ªå¯å†™æµçš„ä¾‹å­ï¼›")]),e._v(" "),a("li",[e._v("Duplexï¼šå¯è¯»å†™çš„æµï¼Œåˆç§°åŒå‘æµã€‚å¦‚Node.jsçš„ç½‘ç»œï¼ˆnetï¼‰ä¸­çš„net.Socketç±»ï¼›")]),e._v(" "),a("li",[e._v("Transformï¼šåœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹å’Œå˜æ¢æ•°æ®çš„ Duplex æµï¼Œåˆç§°å˜æ¢æµã€‚å¦‚Node.jsçš„å‹ç¼©ï¼ˆzlibï¼‰ä¸­çš„zlib.createDeflate(options)ã€‚")])]),e._v(" "),a("blockquote",[a("p",[e._v("åœ¨Node.jsä¸­ï¼Œæ‰€æœ‰çš„æµçš„å®ç°éƒ½ç»§æ‰¿äº†EventEmitterï¼ˆç”¨äºå®ç°å„ç§äº‹ä»¶å¤„ç†çš„eventæ¨¡å—ï¼‰è¿™ä¸ªç±»ï¼Œå› æ­¤ï¼Œåœ¨è¯»å–æˆ–è€…å†™å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šè§¦å‘å„ç§äº‹ä»¶ã€‚")])]),e._v(" "),a("h3",{attrs:{id:"createreadstreamå’Œcreatewritestream"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createreadstreamå’Œcreatewritestream"}},[e._v("#")]),e._v(" createReadStreamå’ŒcreateWriteStream")]),e._v(" "),a("p",[e._v("ç°åœ¨æˆ‘ä»¬äº†è§£äº†æµçš„å«ä¹‰å’Œç±»å‹ï¼Œé‚£ä¹ˆNode.jsä¸­çš„æµæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“"),a("code",[e._v("fs.createReadStream(path,options)")]),e._v("åˆ›å»ºä¸€ä¸ªå¯è¯»æµ,"),a("code",[e._v("fs.createWriteStream(path,options)")]),e._v("åˆ›å»ºä¸€ä¸ªå¯å†™æµ,pathæ˜¯è¯»å–æ–‡ä»¶çš„è·¯å¾„ï¼Œoptionsæ˜¯é…ç½®å‚æ•°ã€‚ï¼ˆè¿™é…ç½®å‚æ•°ä¹Ÿå¿’å¤šäº†ç‚¹ï¼ŒğŸ¤”åŠªåŠ›è®°.....ï¼‰")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("flags")]),e._v("ï¼š å¯è¯»æµé»˜è®¤æ˜¯'r'ï¼Œå¯å†™æµé»˜è®¤æ˜¯'w'ï¼›")]),e._v(" "),a("li",[a("code",[e._v("encoding")]),e._v("ï¼š ç¼–ç æ ¼å¼ã€‚å¯è¯»æµé»˜è®¤æ˜¯nullï¼ˆå…¶å®å°±æ˜¯bufferå•¦ï¼‰ï¼Œå¯å†™æµé»˜è®¤æ˜¯'utf8'ï¼›")]),e._v(" "),a("li",[a("code",[e._v("autoClose")]),e._v("ï¼šæ˜¯å¦è‡ªåŠ¨å…³é—­ã€‚é»˜è®¤éƒ½æ˜¯trueï¼ˆå°±æ˜¯è¯»å®Œæ–‡ä»¶æˆ–è€…å†™å…¥å®Œä¹‹åè‡ªåŠ¨æŠŠæ–‡ä»¶å…³ä¸Šå•¦ï¼‰ï¼›")]),e._v(" "),a("li",[a("code",[e._v("mode")]),e._v("ï¼š è¯»å–å’Œå†™å…¥çš„æ¨¡å¼ã€‚é»˜è®¤éƒ½æ˜¯0o666ï¼ˆå¯è¯»å¯å†™ï¼Œå…«è¿›åˆ¶ï¼‰ï¼›")]),e._v(" "),a("li",[a("code",[e._v("highWaterMark")]),e._v("ï¼š æœ€é«˜æ°´ä½çº¿ã€‚å¯è¯»æµé»˜è®¤æ˜¯64 kbï¼ˆæ¯æ¬¡æœ€å¤šè¯»å–å­—èŠ‚æ•°ï¼‰ï¼Œå¯å†™æµé»˜è®¤æ˜¯16 kbï¼ˆæ¯æ¬¡æœ€å¤šå†™å…¥çš„å­—èŠ‚æ•°ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå ç”¨çš„æœ€å¤§å†…å­˜ï¼‰ï¼›")]),e._v(" "),a("li",[a("code",[e._v("start")]),e._v("ï¼šå¼€å§‹è¯»å–æˆ–è€…å¼€å§‹å†™å…¥çš„ä½ç½®ã€‚é»˜è®¤æ˜¯ä»0å¼€å§‹çš„ï¼ˆå•ä½æ˜¯å­—èŠ‚æ•°ï¼‰ï¼›")]),e._v(" "),a("li",[a("code",[e._v("fd")]),e._v("ï¼šæ–‡ä»¶æ ‡è¯†ç¬¦ã€‚æ˜¯Numberç±»å‹çš„")]),e._v(" "),a("li",[a("code",[e._v("end")]),e._v("ï¼šæ˜¯å¯è¯»æµç‹¬æœ‰çš„ï¼Œè¯»å–æ–‡ä»¶çš„æœ€ç»ˆä½ç½®ï¼Œé»˜è®¤æ˜¯Infinityï¼ˆå•ä½æ˜¯å­—èŠ‚æ•°ï¼‰ã€‚")])]),e._v(" "),a("blockquote",[a("p",[e._v("å…¶å®ï¼Œå‚æ•°è™½ç„¶æ¯”è¾ƒå¤šï¼Œä½†æ˜¯éƒ½å¾ˆå®¹æ˜“ç†è§£ã€‚è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œå¦‚æœstartè®¾ç½®ä¸º0ï¼Œendè®¾ç½®ä¸º5ï¼Œé‚£ä¹ˆå®é™…ä¸Šæœ€ç»ˆè¯»å–çš„ç»“æœæ˜¯6ä¸ªå­—ç¬¦ï¼Œå³ç›¸å½“äºåŒ…å‰åˆåŒ…åï¼ï¼ˆæœ‰ç‚¹å°éœ¸é“å“¦ğŸ˜ï¼‰")])]),e._v(" "),a("p",[e._v("åœ¨Node.jsä¸­ï¼Œä½¿ç”¨"),a("code",[e._v("fs.createReadStream(path,options)")]),e._v("åˆ›å»ºå¯è¯»æµå’Œ"),a("code",[e._v("fs.createWriteStream(path,options)")]),e._v("åˆ›å»ºå¯å†™æµä¸¤ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œéš¾é“æˆ‘ä»¬å°±ç”˜å¿ƒä»…ä»…åœç•™åœ¨èƒ½ç”¨ã€ä¼šç”¨çš„å±‚é¢å—ï¼ŸNoã€Noã€Noï¼æˆ‘ä»¬ä¸ä»…è¦ä¼šç”¨ï¼Œè¿˜è¦çŸ¥é“å…¶ä¸­çš„åŸç†ï¼Œä»–ä»¬æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå…ˆæ¥åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ„Ÿå—ä¸€ä¸‹å…¶ç”¨æ³•ï¼š")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("// 'a.txt'å­˜æ”¾åä¸ªæ•°å­—--\x3e 1234567890 \nlet rs = fs.createReadStream('a.txt', {\n  flags: 'r',\n  encoding: 'utf8',\n  autoClose: true,\n  mode: 0o666,\n  start: 0, \n  end:5,\n  highWaterMark: 2 \n});\nrs.on('data',function (data) {\n  console.log(data);\n  rs.pause();\n});\nsetInterval(() => {\n  rs.resume();\n}, 1000);\n// æœ€åè¾“å‡ºçš„ç»“æœæ˜¯ 01 23 45 \n")])])]),a("blockquote",[a("p",[e._v("ç›‘å¬åˆ°"),a("code",[e._v("'data'")]),e._v("äº‹ä»¶ä¹‹åï¼Œæµåˆ‡æ¢åˆ°æµåŠ¨æ¨¡å¼,æ•°æ®ä¼šè¢«å°½å¯èƒ½å¿«çš„è¯»å‡ºã€‚"),a("code",[e._v("pauseã€resume")]),e._v("äº‹ä»¶æ˜¯ç”¨æ¥æš‚åœå’Œæ¢å¤è§¦å‘"),a("code",[e._v("'data'")]),e._v("äº‹ä»¶çš„ï¼ˆæ„å‘³ç€è¯»å–æ–‡ä»¶çš„æ“ä½œåœæ­¢äº†ï¼‰ã€‚å½“ç„¶è¿˜å¯ä»¥ç›‘å¬"),a("code",[e._v("'end'")]),e._v("äº‹ä»¶ã€"),a("code",[e._v("'open'")]),e._v("äº‹ä»¶ã€"),a("code",[e._v("'close'")]),e._v("äº‹ä»¶ã€"),a("code",[e._v("'error'")]),e._v("äº‹ä»¶ã€‚")])]),e._v(" "),a("p",[e._v("ç›¸æ¯”è¾ƒäºå¯è¯»æµï¼Œæˆ‘ä»¬è¿˜åº”è¯¥çŸ¥é“å¯å†™æµçš„ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š")]),e._v(" "),a("ul",[a("li",[e._v("å¯å†™æµæ˜¯æœ‰"),a("code",[e._v("ç¼“å­˜åŒºçš„æ¦‚å¿µçš„ï¼Œç¬¬ä¸€æ¬¡ä¼šçœŸçš„å¾€æ–‡ä»¶é‡Œå†™ï¼Œåé¢çš„å†…å®¹ä¼šå…ˆå†™åˆ°ç¼“å­˜ä¸­")]),e._v("ï¼›")]),e._v(" "),a("li",[e._v("å¯å†™æµå†™å…¥æ—¶ä¼šè¿”å›ä¸€ä¸ª"),a("code",[e._v("booleanç±»å‹")]),e._v(",å½“è¿”å›ä¸ºfalseæ—¶ï¼Œå°±ä¸è¦åœ¨å†™å…¥äº†ã€‚ï¼ˆä½†å¦‚æœè¿”å›falseä¹‹åè¿˜æœ‰å†™å…¥æ“ä½œï¼Œè¿˜æ˜¯ä¼šå†™å…¥æ–‡ä»¶ä¸­ï¼Œå› ä¸ºè¶…è¿‡çš„éƒ¨åˆ†ä¼šæ”¾åˆ°ç¼“å­˜é‡Œï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´å†…å­˜çš„æµªè´¹ï¼‰ï¼›")]),e._v(" "),a("li",[e._v("æ­£åœ¨å†™å…¥çš„å†…å®¹å’Œç¼“å­˜ä¸­çš„å†…å®¹éƒ½æ¶ˆè€—å®Œåï¼Œä¼šè§¦å‘"),a("code",[e._v("drainäº‹ä»¶")]),e._v("ã€‚")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("// å¦‚æœ'a.txt'ä¸­æœ‰å†…å®¹ï¼Œä¼šè¢«å†™å…¥çš„å†…å®¹è¦†ç›–æ‰\nlet ws = fs.createWriteStream('a.txt',{\n  flags: 'w',\n  mode: 0o666,\n  encoding: 'utf8',\n  autoClose: true,\n  start: 0,\n  highWaterMark: 3\n})\nlet flag = ws.write('1');\nconsole.log(flag); // true\nflag = ws.write('1');\nconsole.log(flag); // true\nflag = ws.write('1');\nconsole.log(flag); // false\n")])])]),a("blockquote",[a("p",[e._v("ä¸Šé¢ä¾‹å­ä¸­ï¼Œæœ€åä¸€æ¬¡è¿”å›çš„æ˜¯"),a("code",[e._v("false")]),e._v("ï¼Œå…¶å®è·Ÿè®¾ç½®çš„"),a("code",[e._v("highWaterMarkæœ€é«˜æ°´ä½çº¿")]),e._v("ï¼ˆè®¾ç½®çš„å½“å‰ç¼“å­˜åŒºå¤§å°ï¼‰æœ‰å…³ç³»äº†ã€‚å½“å†™å…¥çš„å†…å®¹å¤§äºç­‰äº"),a("code",[e._v("highWaterMark")]),e._v("æ—¶ï¼Œå°±ä¼šè¿”å›"),a("code",[e._v("flase")]),e._v("ã€‚")])]),e._v(" "),a("p",[e._v("é‚£æˆ‘ä»¬å¦‚ä½•å»æ§åˆ¶å†™å…¥çš„æ—¶æœºï¼Œä»è€Œä¸é€ æˆå†…å­˜çš„æµªè´¹å‘¢ï¼Ÿè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("// å¤ç”¨ä¸Šä¸ªä¾‹å­ä¸­çš„å¯å†™æµå®ä¾‹ï¼Œå†™å…¥æ—¶åªå ç”¨ä¸‰ä¸ªå­—èŠ‚çš„å†…å­˜\nlet i = 0;\nfunction write(){ // æ¯æ¬¡å†™å…¥ä¸‰ä¸ªå­—èŠ‚ï¼Œç„¶ååœä½ï¼Œå†™å…¥å®Œæˆåå†ç»§ç»­å†™å…¥\n  let flag = true;\n  while(i < 9 && flag){\n    flag = ws.write(i + '');\n    i++\n  }\n}\nws.on('drain',function(){ // è¾¾åˆ°highWaterMarkè§¦å‘è¯¥äº‹ä»¶\n  console.log('å†™å…¥æˆåŠŸ');\n  write();\n})\nwrite(); // a.txtæ–‡ä»¶ä¸­--\x3e 012345678\n")])])]),a("h3",{attrs:{id:"å®ç°createreadstreamå’Œcreatewritestream"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°createreadstreamå’Œcreatewritestream"}},[e._v("#")]),e._v(" å®ç°createReadStreamå’ŒcreateWriteStream")]),e._v(" "),a("p",[e._v("ä¸Šé¢å¤§è‡´äº†è§£äº†"),a("code",[e._v("createReadStreamå’ŒcreateWriteStream")]),e._v("çš„ç”¨æ³•å’Œç‰¹ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è‡ªå·±å®ç°ä¸€ä¸‹å¯è¯»æµå’Œå¯å†™æµï¼Œæ— ç–‘èƒ½åŠ æ·±æˆ‘ä»¬å¯¹å…¶çš„ç†è§£ã€‚ç¿»çœ‹Node.jsçš„æºç ï¼Œ"),a("code",[e._v("å¯è¯»æµfs.createReadStream()")]),e._v("æ‰§è¡Œåè¿”å›çš„æ˜¯"),a("code",[e._v("ReadStreamç±»")]),e._v("çš„å®ä¾‹ï¼Œå¯å†™æµä¹Ÿæ˜¯ä¸€æ ·çš„é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("fs.createReadStream = function(path, options) {\n  return new ReadStream(path, options);\n};\nfs.createWriteStream = function(path, options) {\n  return new WriteStream(path, options);\n};\n")])])]),a("blockquote",[a("p",[e._v("æ˜¯ä¸æ˜¯æ„Ÿè§‰ä¸€ä¸‹å­æ˜æœ—äº†è®¸å¤šï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿå°è£…"),a("code",[e._v("ReadStreamå’ŒWriteStreamç±»")]),e._v("å°±å¯ä»¥äº†ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´å¥½çš„ç†è§£ï¼ŒåŸºæœ¬æ¯å¥ä»£ç éƒ½æœ‰æ³¨é‡Šå“¦ğŸ˜Šï¼ä¸ºå‡å°‘ç¯‡å¹…ï¼Œè¿™é‡Œåªè´´å‡ºæ¥"),a("code",[e._v("æ ¸å¿ƒreadæ–¹æ³•å’Œwriteæ–¹æ³•")]),e._v("çš„å®ç°ï¼Œå…¨éƒ¨ä»£ç è¯·ç§»æ­¥"),a("a",{attrs:{href:"https://github.com/chudongyang/createStream",target:"_blank",rel:"noopener noreferrer"}},[e._v("stream"),a("OutboundLink")],1),e._v("ä¸‹è½½ï¼š")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("class ReadStream extends EventEmitter{\n  read(){ // è¯»å–æ–‡ä»¶\n    if (this.finished) { // è¯»å®Œä¹‹åå°±ä¸å†è¯»äº†\n      return;\n    }\n    // openæ‰“å¼€æ–‡ä»¶æ˜¯å¼‚æ­¥çš„ï¼Œå½“æˆ‘ä»¬è¯»å–çš„æ—¶å€™å¯èƒ½æ–‡ä»¶è¿˜æ²¡æœ‰æ‰“å¼€\n    if(typeof this.fd !== 'number'){\n      this.once('open',()=>this.read());\n      return;\n    }\n    // lengthä»£è¡¨æ¯æ¬¡è¯»å–çš„å­—èŠ‚æ•°\n    let length = this.end ? Math.min(this.highWaterMark, this.end - this.pos + 1) : this.highWaterMark;\n    fs.read(this.fd,this.buffer,0,length,this.pos,(err,bytesRead)=>{\n      if(err){\n        this.emit('error',err);\n        this.destroy();\n        return;\n      }\n      if(bytesRead > 0){ // è¯»åˆ°çš„å­—èŠ‚æ•° \n        this.pos += bytesRead;\n        let res = this.buffer.slice(0, bytesRead); // çœŸå®è¯»å–åˆ°çš„bytesReadå¯èƒ½ä¸èƒ½å¡«æ»¡this.bufferï¼Œéœ€è¦æˆªå–,ä¿ç•™æœ‰ç”¨çš„\n        res = this.encoding ? res.toString(this.encoding) : res;\n        this.emit('data', res);\n        if (this.flowing) { // å¦‚æœæ˜¯æµåŠ¨æ¨¡å¼ï¼Œå°±ç»§ç»­è°ƒç”¨readæ–¹æ³•è¯»å–\n          this.read();\n        }\n      }else {\n        this.finished = true; // è¯»å®Œçš„æ ‡è¯†\n        this.emit('end');\n        this.destroy();\n      }\n    })\n  }\n}\n")])])]),a("blockquote",[a("p",[a("code",[e._v("å¯è¯»æµReadStreamç±»")]),e._v("çš„å°è£…ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯ç†è§£"),a("code",[e._v("readæ–¹æ³•")]),e._v("çš„å®ç°ï¼Œå…¶ä»–çš„æ–¹æ³•éƒ½æ¯”è¾ƒç®€å•å¥½ç†è§£ã€‚"),a("code",[e._v("readæ–¹æ³•")]),e._v("ä¸­æœ€éš¾ç†è§£çš„å°±æ˜¯"),a("code",[e._v("lengthå˜é‡ï¼ˆè¦è¯»å–çš„å­—èŠ‚æ•°ï¼‰")]),e._v("ï¼Œå› ä¸ºè¯»åˆ°æœ€åï¼Œå¯èƒ½æ–‡ä»¶ä¸­çš„å­—èŠ‚æ•°å°äºäº†"),a("code",[e._v("highWaterMarkæœ€é«˜æ°´ä½çº¿")]),e._v("ï¼Œæ‰€ä»¥è¦å–"),a("code",[e._v("Math.min()æœ€å°å€¼")]),e._v("ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼šå¦‚æœ"),a("code",[e._v("this.end = 4;")]),e._v("è¯´æ˜æ€»å…±éœ€è¦è¯»å–5ä¸ªå­—èŠ‚ï¼Œ"),a("code",[e._v("this.highWaterMark= 3ï¼›")]),e._v("è¯´æ˜æ¯æ¬¡è¯»å–3ä¸ªå­—èŠ‚ï¼Œç¬¬ä¸€æ¬¡è¯»å®Œå"),a("code",[e._v("this.pos = 3;")]),e._v("æ­¤æ—¶è¿˜éœ€è¦åœ¨è¯»å–2ä¸ªå­—èŠ‚å°±å¤Ÿäº†ã€‚")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("class WriteStream extends EventEmitter {\n  // chunkï¼šå†™å…¥çš„å†…å®¹ï¼›encodingï¼šç¼–ç æ ¼å¼ï¼›callbackï¼šå†™å…¥å®Œæˆåçš„å›è°ƒ\n  write(chunk,encoding=this.encoding,callback){ // å†™å…¥çš„æ—¶å€™è°ƒç”¨çš„æ–¹æ³•\n     // ä¸ºäº†ç»Ÿä¸€ï¼Œå¦‚æœä¼ é€’çš„æ˜¯å­—ç¬¦ä¸²ä¹Ÿè¦è½¬æˆbuffer\n    chunk = Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk,encoding);\n    this.len += chunk.length; // ç»´æŠ¤ç¼“å­˜çš„é•¿åº¦\n    let ret = this.highWaterMark > this.len;\n    if(!ret){ \n      this.needDrain = true; // è¡¨ç¤ºéœ€è¦è§¦å‘drainäº‹ä»¶\n    }\n    if(this.writing){ // trueè¡¨ç¤ºæ­£åœ¨å†™å…¥,åº”è¯¥æ”¾åœ¨ç¼“å­˜ä¸­\n      this.buffer.push({\n        chunk,\n        encoding,\n        callback\n      });\n    }else{ // ç¬¬ä¸€æ¬¡å†™å…¥\n      this.writing = true;\n      this._write(chunk,encoding,()=>this.clearBuffer()); // å®ç°ä¸€ä¸ªå†™å…¥çš„æ–¹æ³•\n    }\n    return ret; // writeçš„è¿”å›å€¼å¿…é¡»æ˜¯true/false\n  }\n  _write(chunk,encoding,callback){ // å› ä¸ºwriteæ–¹æ³•æ˜¯åŒæ­¥è°ƒç”¨çš„ï¼Œæ­¤æ—¶fdå¯èƒ½è¿˜æ²¡æœ‰è·å–åˆ°\n    if(typeof this.fd !== 'number'){ // åˆ¤æ–­å¦‚æœæ–‡ä»¶è¿˜æ²¡æœ‰æ‰“å¼€\n      return this.once('open',()=>this._write(chunk,encoding,callback));\n    }\n    // å‚æ•°ï¼šfd æ–‡ä»¶æè¿°ç¬¦ï¼› chunkæ˜¯æ•°æ®ï¼› 0ï¼šå†™å…¥çš„bufferå¼€å§‹çš„ä½ç½®ï¼› chunk.lengthå†™å…¥çš„å­—èŠ‚æ•°ï¼› this.posæ–‡ä»¶å¼€å§‹å†™å…¥æ•°æ®çš„ä½ç½®çš„åç§»é‡\n    fs.write(this.fd,chunk,0,chunk.length,this.pos,(err,bytesWritten)=>{\n      this.pos += bytesWritten;\n      this.len -= bytesWritten; // æ¯æ¬¡å†™å…¥åï¼Œå†…å­˜ä¸­çš„ä¹Ÿè¦ç›¸åº”çš„å‡å°‘\n      callback();\n    })\n  }\n  clearBuffer(){ // æ¸…é™¤ç¼“å­˜ä¸­çš„\n    let buf = this.buffer.shift();\n    if(buf){\n      this._write(buf.chunk,buf.encoding,()=>this.clearBuffer());\n    }else{\n      if(this.needDrain){ // å¦‚æœéœ€è¦è§¦å‘drain\n        this.writing = false;\n        this.needDrain = false;// è§¦å‘ä¸€æ¬¡drain å†ç½®å›false æ–¹ä¾¿ä¸‹æ¬¡ç»§ç»­åˆ¤æ–­\n        this.emit('drain');\n      }\n    }\n  }\n}\n")])])]),a("blockquote",[a("p",[e._v("å¯å†™æµä¸­æœ€ä¸»è¦çš„å°±æ˜¯"),a("code",[e._v("writeæ–¹æ³•")]),e._v("ï¼Œå…¶åˆä¾èµ–"),a("code",[e._v("_writeæ–¹æ³•")]),e._v("å’Œ"),a("code",[e._v("clearBufferæ–¹æ³•")]),e._v("ã€‚å…¨éƒ¨ä»£ç è¯·ç§»æ­¥"),a("a",{attrs:{href:"https://github.com/chudongyang/createStream",target:"_blank",rel:"noopener noreferrer"}},[e._v("stream"),a("OutboundLink")],1),e._v("ä¸‹è½½ï¼Œæ›´å¥½ç†è§£å“¦ï½‚ï¼ˆï¿£â–½ï¿£ï¼‰ï½„ï¼")])]),e._v(" "),a("h3",{attrs:{id:"ï¼ˆå››ï¼‰pipeæ–¹æ³•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ï¼ˆå››ï¼‰pipeæ–¹æ³•"}},[e._v("#")]),e._v(" ï¼ˆå››ï¼‰pipeæ–¹æ³•")]),e._v(" "),a("p",[e._v("å…¶å®å•Šï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œåˆæ˜¯ç†è§£å«ä¹‰ï¼Œåˆæ˜¯å°è£…ä»£ç ï¼Œéƒ½æ˜¯ä¸ºäº†çªå‡º"),a("code",[e._v("pipeæ–¹æ³•å¯¼æµ")]),e._v("çš„é‡è¦æ€§å•Šã€‚pipeæ–¹æ³•æ€ä¹ˆä½¿ç”¨å‘¢ï¼Œè¯·æ³¨æ„ï¼ˆå‰æ–¹é«˜èƒ½ï¼‰ï¼š")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("let fs = require('fs');\nlet rs = fs.createReadStream('a.txt', { \n  highWaterMark: 4\n});\nlet ws = fs.createWriteStream('b.txt', { \n  highWaterMark: 1\n});\nrs.pipe(ws);\n")])])]),a("blockquote",[a("p",[e._v("ç”¨æ³•æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œå¾ˆç›´æ¥å‘€ï¼è™½ç„¶ä»…ä»…è¿™ä¸€è¡Œçš„ä»£ç ,ä½†è¿™æ­£æ˜¯å…¶ç¥å¥‡ä¹‹å¤„å•Šã€‚ï¼ˆè¯´å¥½çš„é«˜èƒ½å‘¢ï¼Ÿå°æ¿å‡³éƒ½å‡†å¤‡å¥½äº†ï¼Œä½ å‘Šè¯‰æˆ‘è¿™äº›ï¼‰ã€‚\né‚£æˆ‘ä»¬æ€ä¹ˆå»å®ç°ä¸€ä¸ªpipeæ–¹æ³•å‘¢ï¼Ÿå…¶å®åŸºäºä¸Šé¢"),a("code",[e._v("å¯è¯»æµcreateReadStreamå’Œå¯å†™æµcreateWriteStream")]),e._v("çš„å°è£…ï¼Œpipeçš„å®ç°å°±æ˜¾å¾—å¾ˆç®€å•äº†ï¼Œåœ¨"),a("code",[e._v("ReadStreamç±»çš„åŸå‹ä¸Šå°è£…pipeæ–¹æ³•")]),e._v(",ä»£ç å¦‚ä¸‹ï¼š")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("class ReadStream extends EventEmitter{\n  pipe(dest){\n    this.on('data',(data)=>{\n      let flag = dest.write(data);\n      if(!flag){\n        this.pause(); // ä¸èƒ½ç»§ç»­è¯»å–äº†ï¼Œç­‰å†™å…¥å®Œæˆåå†ç»§ç»­è¯»å–\n      }\n    });\n    dest.on('drain',()=>{\n      this.resume();\n    })\n  }\n}\n")])])]),a("blockquote",[a("p",[e._v("å†æ¬¡å‹æƒ…æç¤ºï¼šä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œå¯ä»¥ç§»æ­¥è¿™é‡Œ"),a("a",{attrs:{href:"https://github.com/chudongyang/createStream",target:"_blank",rel:"noopener noreferrer"}},[e._v("stream"),a("OutboundLink")],1),e._v("ä¸‹è½½å…¨éƒ¨ä»£ç å“¦(ï¿£â–½ï¿£)~*ï¼")])]),e._v(" "),a("ul",[a("li",[e._v("pipeæ–¹æ³•åˆå«ç®¡é“æ–¹æ³•ï¼Œæœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯å¯ä»¥æ§åˆ¶é€Ÿç‡ï¼ˆé˜²æ­¢æ·¹æ²¡å¯ç”¨å†…å­˜ï¼‰ï¼›")]),e._v(" "),a("li",[e._v("pipeæ–¹æ³•çš„å®ç°åŸç†ï¼šå¯è¯»æµå®ä¾‹"),a("code",[e._v("rs")]),e._v("ç›‘å¬"),a("code",[e._v("on('data')æ–¹æ³•")]),e._v("ï¼Œå°†è¯»å–åˆ°çš„å†…å®¹è°ƒç”¨"),a("code",[e._v("ws.writeæ–¹æ³•")]),e._v("ï¼ˆwsæ˜¯å¯å†™æµå®ä¾‹ï¼‰ï¼Œå…¶æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª"),a("code",[e._v("booleanç±»å‹")]),e._v("ï¼Œå¦‚æœè¿”å›"),a("code",[e._v("falseä¼šè°ƒç”¨rs.pause()æš‚åœè¯»å–")]),e._v("ï¼Œç­‰å¾…å¯å†™æµå†™å…¥å®Œæ¯•åï¼Œè°ƒç”¨"),a("code",[e._v("ws.on('drain')åœ¨æ¢å¤è¯»å–")]),e._v("ã€‚")])]),e._v(" "),a("p",[e._v("æ€»ç»“ï¼šNode.jsæµåˆ°è¿™é‡Œå°±å‘Šä¸€æ®µè½äº†ï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼å¦‚æœæœ‰é—®é¢˜æ¬¢è¿æŒ‡å‡ºï¼Œå…±åŒè¿›æ­¥å“¦ï¼å¦‚æœæ„Ÿè§‰æ–‡ç« æœ‰ç‚¹æ™¦æ¶©éš¾æ‡‚ï¼Œå¯ä»¥å…ˆæ”¶è—ï¼Œæ–¹ä¾¿ä»¥åé˜…è¯»å“¦â¤ï¸ï¼")]),e._v(" "),a("p",[e._v("å‚è€ƒæ–‡ç« ï¼š")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://medium.freecodecamp.org/node-js-streams-everything-you-need-to-know-c9141306be93",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js Streams: Everything you need to know"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("ã€ŠNode.jsæƒå¨æŒ‡å—ã€‹")]),e._v(" "),a("li",[a("a",{attrs:{href:"http://nodejs.cn/api/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.jsä¸­æ–‡ç½‘"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);